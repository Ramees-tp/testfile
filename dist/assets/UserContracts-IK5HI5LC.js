import{b,r as a,j as e,L as w}from"./index-YyWu4Jnp.js";import{a as h}from"./axios-jMTBJgDy.js";import{R as y}from"./RazorpayPayment-0YUDDbSH.js";import{F as N}from"./index-waHClJbd.js";import{c as v}from"./index-xM9OYPTF.js";import{H as k,U as C}from"./Ufooter-fp5fdVN5.js";import"./axios-L6U4YIEh.js";import"./index-mTfGpBqG.js";import"./UserRoutes-d-6EDLbB.js";const S=()=>{const l=b(s=>s.socket.socket),[c,d]=a.useState([]),[i,m]=a.useState(!1),[x,n]=a.useState(""),o=async()=>{try{const s=await h.get("/user/showRequests");s.status===200&&d(s.data.requests)}catch(s){s.response&&s.response.data.message?n(s.response.data.message):n("Internal server error")}};a.useEffect(()=>{const s=localStorage.getItem("jwt");if(s){const r=t(s),f=r?r.id:null;f&&l.emit("userConnection",{sender:f})}return o(),l.on("userUpdateRequest",()=>{o()}),()=>{l.off("userUpdateRequest")}},[]);const p=async s=>{try{(await h.delete(`/user/cancelRequest/${s}`)).status===200&&o()}catch(r){r.response&&r.response.data.message?n(r.response.data.message):n("Internal server error")}},g=()=>{m(!0)},t=s=>{try{const f=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),u=decodeURIComponent(atob(f).split("").map(function(j){return"%"+("00"+j.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(u)}catch{return null}};return e.jsx("div",{children:e.jsxs("div",{className:"sm:min-h-[500px] min-h-[350px]",children:[e.jsx("h2",{className:"tm:text-2xl text-xl font-bold md:mb-6 mb-1 text-gray-600 underline",children:"Your Requests "}),e.jsx("div",{className:"-my-2 py-2 overflow-x-auto sm:-mx-6 sm:px-6 lg:-mx-8 md:pr-10 lg:px-8",children:c.length>0&&c.filter(s=>!s.payment).map(s=>e.jsx("div",{className:"align-middle rounded-tl-lg rounded-tr-lg inline-block w-full py-4 overflow-hidden bg-white shadow-lg md:px-12 px-4 ",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center md:p-8 p-2 bg-[#d5e6eb] shadow rounded-lg",children:e.jsxs("div",{className:"w-full flex sm:flex-row flex-col justify-center gap-y-3",children:[e.jsxs("div",{className:"tm:space-y-2",children:[e.jsx("span",{className:"block text-gray-500 ",children:s.workerId.jobType}),e.jsxs("span",{className:"block md:text-2xl tm:text-xl text-lg font-bold",children:[s.workerId.firstName," ",s.workerId.lastName]}),e.jsxs("span",{className:"block text-gray-500 tm:text-base text-[90%]",children:[new Date(s.date).toLocaleDateString()," - ",s.day]}),e.jsx("span",{className:"block text-gray-500 tm:text-base text-[90%]",children:s.workerId.workArea}),e.jsx("span",{className:"block text-green-500 tm:text-base text-[90%]",children:e.jsxs("p",{children:["Amount : ",s.wage]})})]}),e.jsxs("div",{className:"md:ml-auto flex justify-center items-center",children:[e.jsx("div",{className:`inline-flex tm:px-5 px-2 tm:py-2 py-1 ${s.status==="pending"?"text-red-500 border-red-500":s.status==="accepted"?"text-white bg-green-600 hover:bg-green-700 cursor-pointer":"text-white bg-red-700"} rounded-md ml-3 border`,children:s.status==="accepted"?e.jsx(y,{orderId:s._id,wage:s.wage,type:"user",onPaymentCompleted:g}):e.jsx("span",{className:"block",children:s.status})}),e.jsx("button",{onClick:()=>p(s._id),className:"inline-flex tm:px-6 px-3 tm:py-2 py-1 text-purple-600 hover:text-purple-700 focus:text-purple-700 hover:bg-purple-100 focus:bg-purple-100 border border-purple-600 rounded-md ml-3",children:"Cancel"})]})]})}),i&&e.jsx("div",{className:"font-bold text-green-500 mt-4",children:"Payment completed successfully!"})]})},s._id))})]})})};function I({userId:l,workerId:c,requestId:d}){const i=b(t=>t.socket.socket),[m,x]=a.useState([]),[n,o]=a.useState(""),p=t=>{h.post("/user/saveMessages",t)},g=()=>{if(n.trim()!==""){i.emit("sendMessage",{message:n,sender:l,receiver:c,requestId:d});const t={message:n,sender:l,receiver:c,requestId:d};x(s=>[...s,{message:n,sender:l,type:"sent"}]),p(t),o("")}};return a.useEffect(()=>{i.emit("userConnection",{sender:l})},[l]),a.useEffect(()=>{(async()=>{try{const s=await h.get("/user/showMessage",{params:{workerId:c,userId:l,requestId:d}});if(s.data&&s.data.success){const r=s.data.messages;x(r)}}catch(s){console.error(s)}})()},[]),a.useEffect(()=>{const t=({message:s,sender:r,requestId:f})=>{f===d&&x(u=>[...u,{message:s,sender:r,type:"received"}])};return i.on("sendMessage",t),()=>{i.off("sendMessage",t)}},[]),e.jsx("div",{className:"h-full bg-slate-200 rounded-md",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-grow p-4 border-b-2 border-gray-300",children:e.jsx("div",{className:"overflow-y-auto h-full",children:m.map((t,s)=>e.jsx("div",{className:`mb-2 text-lg ${t.sender===l?"flex justify-end":"flex justify-start"}`,children:e.jsxs("div",{className:` max-w-[70%] w-fit p-2 rounded text-white flex flex-col leading-5 ${t.sender===l?"bg-green-900  pl-8 py-1":"bg-gray-700 pr-8"}`,children:[e.jsx("span",{className:"font-bold text-[60%] text-right",children:t.sender===l?"You":""}),e.jsx("span",{children:t.message})]})},s))})}),e.jsxs("div",{className:"flex items-center lg:p-4 border-t-2 border-gray-300",children:[e.jsx("input",{type:"text",className:"flex-grow h-full mr-2 p-2 border border-gray-300 rounded",placeholder:"Type your message...",value:n,onChange:t=>o(t.target.value)}),e.jsx(N,{icon:v,onClick:g,className:"fa-regular cursor-pointer p-2 h-6 w-6 bg-green-500 text-white rounded hover:bg-green-700"})]})]})})}const R=()=>{const[l,c]=a.useState([]),[d,i]=a.useState(!1),[m,x]=a.useState(null),[n,o]=a.useState(""),p=async()=>{try{const s=await h.get("/user/showRequests");s.status===200&&c(s.data.requests)}catch(s){s.response&&s.response.data.message?o(s.response.data.message):o("Internal server error")}};a.useEffect(()=>{p()},[]);const g=s=>{x(s),i(r=>!r)},t=async s=>{try{(await h.delete(`/user/cancelRequest/${s}`)).status===200&&p()}catch(r){r.response&&r.response.data.message?o(r.response.data.message):o("Internal server error")}};return e.jsxs("div",{className:"sm:min-h-[500px] min-h-[350px]",children:[e.jsx("h2",{className:"tm:text-2xl text-xl font-bold sm:mb-6 mb-3 text-gray-600 underline",children:"Contracts"}),l.length===0&&e.jsxs("div",{className:"flex flex-col justify-center items-center h-full gap-y-5",children:[e.jsx("p",{className:"font-bold tm:text-2xl text-lg text-gray-600",children:"You Didn't Made Any Contracts"}),e.jsx(w,{to:"/user/uhome",children:e.jsx("button",{className:"bg-violet-600 hover:bg-violet-400 text-white font-semibold tm:px-4 px-2 tm:py-2 py-1 rounded cursor-pointer animate-bounce",children:"Make One"})})]}),l.length>0&&l.filter(s=>s.payment).map(s=>e.jsxs("div",{className:"flex sm:flex-row flex-col gap-4 mb-5",children:[e.jsxs("div",{className:"-my-2 py-2 overflow-x-auto sm:-mx-6 sm:px-6 lg:-mx-8 md:pr-10 lg:px-8 lg:w-[70%]",children:[e.jsxs("section",{className:`align-middle rounded-tl-lg rounded-tr-lg inline-block w-full py-4 overflow-hidden bg-slate-100 shadow-xl ${d?"lg:px-12":"sm:px-12"} relative`,children:[s.completed&&e.jsx("div",{className:"absolute top-0 left-0 w-full h-full flex items-center justify-center  bg-gray-800 bg-opacity-75 text-white rounded-t-lg sm:px-12",children:e.jsx("p",{className:"text-4xl font-bold text-green-500 p-36"})}),e.jsxs("div",{className:"flex md:flex-row flex-col md:items-start items-center w-full tm:gap-4",children:[e.jsx("div",{className:"md:w-[30%]",children:e.jsx("div",{className:"tm:w-32 w-24 tm:h-32 h-24 rounded-full overflow-hidden bg-gray-200",children:e.jsx("img",{src:s.workerId.profileImage,alt:"profile",className:"object-cover w-full h-full"})})}),e.jsxs("div",{className:"flex md:flex-col flex-col-reverse w-full tm:items-center tm:ml-auto md:gap-y-5 gap-y-2",children:[e.jsxs("div",{className:"w-full flex md:justify-end justify-center bg-slate-300 p-1 pr-3 rounded-md",children:[e.jsx("p",{className:"mr-4 font-semibold tm:text-base text-[80%] text-red-900",children:"OrderID"}),e.jsx("p",{children:s._id})]}),e.jsxs("div",{className:"grid sm:grid-cols-6 grid-cols-1 sm:grid-rows-2 grid-rows-2 lg:gap-5 lg:w-[70%] text-gray-800 tm:ml-0 ml-8",children:[e.jsxs("p",{className:"sm:col-span-4 flex items-center text-2xl font-bold",children:[s.workerId.firstName," ",s.workerId.lastName]}),e.jsx("p",{className:"flex items-center font-semibold",children:s.workerId.jobType}),e.jsxs("p",{className:"sm:col-span-4 flex items-center tm:text-xl text-[90%] text-green-900",children:[new Date(s.date).toLocaleDateString()," - ",s.day]}),e.jsx("p",{className:"flex items-center",children:s.workerId.workArea})]})]})]})]}),e.jsxs("section",{className:"align-middle inline-block min-w-full shadow overflow-hidden bg-slate-100 shadow-dashboard lg:px-8 px-2 md:pt-3 rounded-bl-lg rounded-br-lg relative",children:[s.completed&&e.jsx("div",{className:"absolute top-0 left-0 w-full h-full flex items-center justify-center bg-gray-800 bg-opacity-75 text-white rounded-b-lg sm:px-12",children:e.jsx("p",{className:"text-center tm:text-4xl text-2xl font-bold text-green-500 p-36",children:"Work Completed"})}),e.jsx("p",{className:"text-lg text-gray-700 font-bold",children:"Contact"}),e.jsxs("div",{className:" flex flex-col justify-center mt-4 work-sans bg-white shadow-xl rounded lg:p-6 p-2 mb-5",children:[e.jsxs("div",{className:"grid md:grid-cols-2 md:grid-rows-3 items-center text-gray-800  md:w-[30%] md:gap-x-20 md:text-base sm:text-[85%] text-[75%]",children:[e.jsx("p",{className:" font-bold",children:"Call"}),e.jsx("p",{children:s.workerId.phoneNumber}),e.jsx("p",{className:" font-bold",children:"EMAIL"}),e.jsx("p",{children:s.workerId.email}),e.jsx("p",{className:" font-bold",children:"Worker ID"}),e.jsx("p",{children:s.workerId._id}),e.jsx("p",{className:" font-bold",children:"Secret Code"}),e.jsx("p",{className:"md:text-base sm:text-[85%] text-base font-bold text-blue-700 border-2 border-blue-900 rounded px-2 w-24 text-center",children:s.secretcode})]}),e.jsxs("div",{className:"md:ml-auto flex justify-center mt-5",children:[e.jsx("button",{onClick:()=>t(s._id),className:" inline-flex md:px-5 px-2 md:py-2 py-1 text-purple-600 hover:text-purple-700 focus:text-purple-700 hover:bg-purple-100 focus:bg-purple-100 border border-purple-600 rounded-md ml-3",children:"Cancel"}),e.jsx("button",{onClick:()=>g(s._id),className:" inline-flex md:px-5 px-2 md:py-2 py-1 text-green-600 hover:text-green-700 focus:text-green-700 hover:bg-green-100 focus:bg-green-100 border border-green-600 rounded-md ml-3",children:d&&m._id===s._id?"Close Chat":"Live Chat"})]})]})]})]}),e.jsx("div",{className:"lg:w-[30%]",children:d&&m===s._id&&e.jsx(I,{workerId:s.workerId._id,userId:s.userId,requestId:s._id})})]},s._id))]})},M=()=>{const[l,c]=a.useState(!0),[d,i]=a.useState(!1),[m,x]=a.useState(1),n=o=>{switch(c(!1),i(!1),x(o),o){case 1:c(!0);break;case 2:i(!0);break}};return e.jsx("div",{className:"bg-[#fffdcb]",children:e.jsxs("main",{className:"tm:p-2 sm:p-10 p-2 space-y-6 ",children:[e.jsxs("div",{className:"flex flex-col tm:gap-y-6 gap-y-3 md:space-y-0 md:flex-row justify-between md:items-center",children:[e.jsxs("div",{className:"mr-6 ml-2 mt-2",children:[e.jsx("h1",{className:"md:text-4xl tm:text-3xl text-2xl font-semibold md:mb-2",children:"Contract Details"}),e.jsx("h2",{className:"text-gray-600 ml-0.5 tm:text-base text-[87%]",children:"Your Contracts And Requests"})]}),e.jsxs("div",{className:"flex flex-wrap items-start tm:justify-end justify-center -mb-3",children:[e.jsx("button",{onClick:()=>n(1),className:`inline-flex tm:px-4 px-2 tm:py-2 py-1  border border-purple-600 rounded-md mb-3 ${m===1?"bg-purple-600 text-white":"bg-purple-200 text-purple-600"}`,children:"Contracts"}),e.jsx("button",{onClick:()=>n(2),className:`inline-flex tm:px-4 px-2 tm:py-2 py-1  border border-purple-600 rounded-md mb-3 ml-6 ${m===2?"bg-purple-600 text-white":"bg-purple-200 text-purple-600"}`,children:"Requests"})]})]}),e.jsxs("section",{className:"bg-white md:p-8 p-2 shadow rounded-lg h-full",children:[l&&e.jsx(R,{}),d&&e.jsx(S,{})]})]})})},B=()=>e.jsxs("div",{className:"p-1",children:[e.jsx(k,{}),e.jsx(M,{}),e.jsx(C,{})]});export{B as default};
